{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Pedidos de Cartas Pendentes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="{% static 'webiel/img/icons/logo.png' %}"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            min-height: 100vh;
            display: flex;
            margin: 0;
            font-family: "Poppins", sans-serif;
            color: #212529;
        }
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #1e3a8a, #3b82f6);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 20px;
            box-shadow: 3px 0 10px rgba(0,0,0,0.2);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        .sidebar.closed {
            transform: translateX(-100%);
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar a {
            color: #fff;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: background 0.3s ease, transform 0.2s ease;
            font-size: 15px;
            font-weight: 500;
        }
        .sidebar a:hover {
            background-color: #2563eb;
            transform: translateX(5px);
        }
        .sidebar .active {
            background-color: #2563eb;
            border-left: 4px solid #fff;
        }
        .sidebar .footer-bottom {
            background: transparent;
            padding: 15px 20px;
            color: white;
            margin-top: auto;
            font-size: 12px;
            text-align: center;
        }
        .sidebar .footer-bottom a {
            color: #93c5fd;
            text-decoration: none;
            font-weight: 500;
        }
        .content {
            margin-left: 250px;
            padding: 30px;
            width: 100%;
            transition: margin-left 0.3s ease-in-out;
        }
        .menu-toggle {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1100;
            background-color: #1e3a8a;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            display: none;
        }
        .menu-toggle:hover {
            background-color: #2563eb;
            transform: scale(1.1);
        }
        .table-section {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            max-width: 1400px;
            margin: 0 auto;
            margin-bottom: 30px;
        }
        .table-section h2 {
            color: #1e3a8a;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: left;
        }
        .table {
            font-size: 14px;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        .table th {
            background: #1e3a8a;
            color: white;
            padding: 12px;
            font-weight: 500;
        }
        .table td {
            background: #f8fafc;
            padding: 12px;
            vertical-align: middle;
            border-bottom: 1px solid #e2e8f0;
        }
        .table tbody tr:hover {
            background-color: #f1f5f9;
        }
        .actions-container {
            display: flex;
            flex-wrap: nowrap;
            gap: 12px;
            align-items: center;
            justify-content: flex-start;
        }
        .status-icon {
            cursor: pointer;
            transition: color 0.3s ease, transform 0.2s ease;
            font-size: 1.3rem;
        }
        .status-icon:hover {
            transform: scale(1.2);
        }
        .mark-done:hover { color: #f59e0b; }
        .edit-icon:hover { color: #2563eb; }
        .delete-icon:hover { color: #dc3545; }
        .view-icon:hover { color: #0dcaf0; }
        .card-carta {
            display: none;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-carta:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .card-carta .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 12px;
        }
        .card-carta .card-text {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 8px;
        }
        .pagination .page-link {
            font-size: 14px;
            padding: 8px 14px;
            border-radius: 6px;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .pagination .page-link:hover {
            background: #2563eb;
            color: white;
        }
        .filter-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .filter-section .form-label {
            font-weight: 500;
            color: #1e3a8a;
            font-size: 14px;
        }
        .filter-section input, .filter-section select {
            border-radius: 6px;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ced4da;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .filter-section input:focus, .filter-section select:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 0.25rem rgba(37, 99, 235, 0.25);
            outline: none;
        }
        .filter-section button {
            border-radius: 6px;
            padding: 8px;
            font-size: 14px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .filter-section button:hover {
            transform: scale(1.05);
        }
        .btn-brand {
            background-color: #2563eb;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            color: #fff;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-brand:hover {
            background-color: #1e3a8a;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #6c757d;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            color: #fff;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .summary-card h4 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
        }
        .summary-card p {
            font-size: 26px;
            font-weight: 700;
        }
        .summary-card .tooltip-text {
            visibility: hidden;
            background-color: #1e3a8a;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .summary-card:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .chart-container {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }
        .filter-toggle {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .filter-toggle label {
            font-weight: 500;
            color: #1e3a8a;
        }
        .filter-toggle select, .filter-toggle input {
            border-radius: 6px;
            padding: 8px;
            font-size: 14px;
        }
        .view-toggle-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .view-toggle-btn:hover {
            background: #1e40af;
            transform: scale(1.05);
        }
        .view-toggle-btn.active {
            background: #1e40af;
        }
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .modal-content {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .modal-header {
            background-color: #1e3a8a;
            color: white;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .modal-footer .btn {
            border-radius: 6px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .content {
                margin-left: 0;
                padding: 15px;
            }
            .menu-toggle {
                display: block;
            }
            .table-section {
                padding: 15px;
            }
            .table-responsive {
                display: none;
            }
            .card-carta {
                display: block;
            }
            .pagination {
                flex-wrap: wrap;
            }
            .pagination .page-link {
                font-size: 12px;
                padding: 6px 10px;
            }
            .dashboard-summary {
                grid-template-columns: 1fr;
            }
            .filter-section .row {
                flex-direction: column;
            }
            .filter-section input, .filter-section select, .filter-section button {
                width: 100%;
                font-size: 12px;
                padding: 6px;
            }
            .actions-container {
                gap: 8px;
            }
            .status-icon {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    {% csrf_token %}
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <button class="menu-toggle" id="menuToggle" aria-label="Alternar menu lateral">
        <i class="bi bi-list"></i>
    </button>

    <div class="sidebar" id="sidebar">
        <h4 class="text-center mb-4">Menu</h4>
        <a href="{% url 'webiel:dashboard' %}" class="active"><i class="bi bi-envelope me-2"></i> Cartas</a>
        <a href="{% url 'webiel:cartas_recebidas' %}"><i class="bi bi-check-circle-fill me-2"></i> Cartas Recebidas</a>
        <a href="{% url 'webiel:publicacao_criar' %}"><i class="bi bi-pencil-square me-2"></i> Cria Publicação</a>
        <a href="{% url 'webiel:criar_foto' %}"><i class="bi bi-camera me-2"></i> Upload de Fotos</a>
        <a href="{% url 'webiel:nubentes' %}"><i class="bi bi-people-fill me-2"></i> Nubentes</a>
        <a href="{% url 'webiel:banco_de_alimentacao' %}"><i class="bi bi-database-fill me-2"></i> Banco de Alimentação</a>
        <a href="{% url 'webiel:mensagens_newsletter' %}"><i class="bi bi-envelope-paper me-2"></i> Mensagens e Newsletter</a>
        <a href="{% url 'webiel:inscricoes' %}"><i class="bi bi-check-circle-fill me-2"></i> Inscrições Feitas</a>
        <div class="footer-bottom text-center">
            <p class="mb-0">
                Copyright © <script>document.write(new Date().getFullYear());</script> |
                Todos os Direitos Reservados - IEL | Created by
                <a id="afonso" href="https://api.whatsapp.com/send?phone=245934038572" target="_blank"
                style="color: #fff; text-decoration: none;">
                    <i class="bi bi-heart-fill"></i> Afonso Miqueias
                </a>
            </p>
        </div>
    </div>

    <div class="content">
        <div class="container mt-5 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-primary">Painel de Pedidos de Cartas Pendentes</h2>
                <div>
                    <p class="text-muted mb-0">
                        Bem-vindo, <strong>{{ user.username }}</strong> |
                        <a href="{% url 'webiel:cartas_feitas' %}" class="btn btn-sm btn-brand">Ver Cartas Concluídas</a>
                        <a href="{% url 'webiel:logout' %}" class="btn btn-sm btn-outline-danger">Sair</a>
                    </p>
                </div>
            </div>

            <div class="toast-container">
                <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Sucesso</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body" id="successToastMessage"></div>
                </div>
                <div id="errorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-danger text-white">
                        <strong class="me-auto">Erro</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body" id="errorToastMessage"></div>
                </div>
            </div>

            <div class="filter-section">
                <h3>Filtros</h3>
                <form id="filterForm">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="searchInput" class="form-label">Pesquisar</label>
                            <input type="text" id="searchInput" name="search" class="form-control" placeholder="Nome, email ou referência" value="{{ search }}">
                        </div>
                        <div class="col-md-3">
                            <label for="referenciaFilter" class="form-label">Referência</label>
                            <input type="text" id="referenciaFilter" name="referencia" class="form-control" placeholder="Ex.: REC2026-001" value="{{ referencia }}">
                        </div>
                        <div class="col-md-3">
                            <label for="tipoFilter" class="form-label">Tipo de Carta</label>
                            <select id="tipoFilter" name="tipo" class="form-select">
                                <option value="">Todos os Tipos</option>
                                {% for tipo in tipos_carta %}
                                <option value="{{ tipo }}" {% if tipo == tipo_carta %}selected{% endif %}>{{ tipo }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="dataFilter" class="form-label">Data de Solicitação</label>
                            <input type="date" id="dataFilter" name="data" class="form-control" value="{{ data }}">
                        </div>
                        <div class="col-md-3 d-flex align-items-end gap-2">
                            <button type="submit" class="btn btn-brand w-100">Filtrar</button>
                            <button type="button" id="clearFilters" class="btn btn-secondary w-100">Limpar</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="filter-toggle">
                <label for="dashboard-view">Visualizar Estatísticas:</label>
                <button class="view-toggle-btn active" data-view="tipo">Por Tipo</button>
                <button class="view-toggle-btn" data-view="data">Por Data</button>
            </div>

            <div class="dashboard-summary">
                <div class="summary-card" id="total-pendentes-card">
                    <h4>Cartas Pendentes</h4>
                    <p id="total-pendentes" data-value="{{ total_pendentes }}">{{ total_pendentes }}</p>
                    <span class="tooltip-text">Número de cartas aguardando conclusão</span>
                </div>
                <div class="summary-card" id="total-feitas-card">
                    <h4>Cartas Concluídas</h4>
                    <p id="total-feitas" data-value="{{ total_feitas }}">{{ total_feitas }}</p>
                    <span class="tooltip-text">Número de cartas concluídas</span>
                </div>
                <div class="summary-card" id="total-geral-card">
                    <h4>Total de Cartas</h4>
                    <p id="total-geral" data-value="{{ total_geral }}">{{ total_geral }}</p>
                    <span class="tooltip-text">Total de cartas registradas</span>
                </div>
            </div>

            <div class="chart-container">
                <h3>Estatísticas de Cartas Pendentes</h3>
                <div class="loader" id="chart-loader"></div>
                <canvas id="cartaChart" width="400" height="200"></canvas>
            </div>

            <div class="table-section" id="table-section">
                <div id="no-data-message" class="alert alert-warning rounded shadow-sm" style="display: {% if not cartas %}block{% else %}none{% endif %};">Nenhum pedido de carta pendente encontrado.</div>
                <div class="table-responsive" style="display: {% if cartas %}block{% else %}none{% endif %}">
                    <table class="table table-hover align-middle" id="cartasTable">
                        <thead>
                            <tr>
                                <th>Referência</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Destino</th>
                                <th>Objetivo</th>
                                <th>Tipo</th>
                                <th>Telefone</th>
                                <th>Data Solicitação</th>
                                <th style="width: 150px;">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for carta in cartas %}
                            <tr data-carta-id="{{ carta.id }}">
                                <td>{{ carta.referencia }}</td>
                                <td>{{ carta.nome }}</td>
                                <td>{{ carta.email }}</td>
                                <td>{{ carta.destino }}</td>
                                <td>{{ carta.objectivo }}</td>
                                <td>{{ carta.tipo_carta }}</td>
                                <td>{{ carta.telefone }}</td>
                                <td>{{ carta.data_solicitacao|date:"d/m/Y H:i" }}</td>
                                <td>
                                    <div class="actions-container">
                                        <span class="status-icon text-warning mark-done" title="Marcar como concluída" data-id="{{ carta.id }}">
                                            <i class="bi bi-hourglass-split"></i>
                                        </span>
                                        <span class="status-icon text-primary edit-icon" title="Editar" data-id="{{ carta.id }}" data-bs-toggle="modal" data-bs-target="#editCartaModal">
                                            <i class="bi bi-pencil-square"></i>
                                        </span>
                                        <span class="status-icon text-danger delete-icon" title="Deletar" data-id="{{ carta.id }}">
                                            <i class="bi bi-trash"></i>
                                        </span>
                                        <span class="status-icon text-info view-icon" title="Visualizar" data-id="{{ carta.id }}" data-bs-toggle="modal" data-bs-target="#viewCartaModal">
                                            <i class="bi bi-eye"></i>
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-list" style="display: {% if cartas %}block{% else %}none{% endif %}">
                    {% for carta in cartas %}
                    <div class="card-carta" data-carta-id="{{ carta.id }}">
                        <div class="card-title">{{ carta.nome }} ({{ carta.referencia }})</div>
                        <div class="card-text"><strong>Referência:</strong> {{ carta.referencia }}</div>
                        <div class="card-text"><strong>Email:</strong> {{ carta.email }}</div>
                        <div class="card-text"><strong>Destino:</strong> {{ carta.destino }}</div>
                        <div class="card-text"><strong>Objetivo:</strong> {{ carta.objectivo }}</div>
                        <div class="card-text"><strong>Tipo:</strong> {{ carta.tipo_carta }}</div>
                        <div class="card-text"><strong>Telefone:</strong> {{ carta.telefone }}</div>
                        <div class="card-text"><strong>Data Solicitação:</strong> {{ carta.data_solicitacao|date:"d/m/Y H:i" }}</div>
                        <div class="card-text">
                            <strong>Ações:</strong>
                            <div class="actions-container">
                                <span class="status-icon text-warning mark-done" title="Marcar como concluída" data-id="{{ carta.id }}">
                                    <i class="bi bi-hourglass-split"></i>
                                </span>
                                <span class="status-icon text-primary edit-icon" title="Editar" data-id="{{ carta.id }}" data-bs-toggle="modal" data-bs-target="#editCartaModal">
                                    <i class="bi bi-pencil-square"></i>
                                </span>
                                <span class="status-icon text-danger delete-icon" title="Deletar" data-id="{{ carta.id }}">
                                    <i class="bi bi-trash"></i>
                                </span>
                                <span class="status-icon text-info view-icon" title="Visualizar" data-id="{{ carta.id }}" data-bs-toggle="modal" data-bs-target="#viewCartaModal">
                                    <i class="bi bi-eye"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <nav aria-label="Navegação de página" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search|urlencode }}{% endif %}{% if request.GET.referencia %}&referencia={{ request.GET.referencia|urlencode }}{% endif %}{% if request.GET.tipo %}&tipo={{ request.GET.tipo|urlencode }}{% endif %}{% if request.GET.data %}&data={{ request.GET.data|urlencode }}{% endif %}" aria-label="Página anterior">Anterior</a>
                        </li>
                        {% endif %}
                        <li class="page-item disabled">
                            <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
                        </li>
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search|urlencode }}{% endif %}{% if request.GET.referencia %}&referencia={{ request.GET.referencia|urlencode }}{% endif %}{% if request.GET.tipo %}&tipo={{ request.GET.tipo|urlencode }}{% endif %}{% if request.GET.data %}&data={{ request.GET.data|urlencode }}{% endif %}" aria-label="Próxima página">Próxima</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>

        <div class="modal fade" id="viewCartaModal" tabindex="-1" aria-labelledby="viewCartaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="viewCartaModalLabel">Detalhes da Carta</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Referência:</strong> <span id="modal-referencia"></span></p>
                        <p><strong>Nome:</strong> <span id="modal-nome"></span></p>
                        <p><strong>Email:</strong> <span id="modal-email"></span></p>
                        <p><strong>Destino:</strong> <span id="modal-destino"></span></p>
                        <p><strong>Objetivo:</strong> <span id="modal-objetivo"></span></p>
                        <p><strong>Tipo:</strong> <span id="modal-tipo"></span></p>
                        <p><strong>Telefone:</strong> <span id="modal-telefone"></span></p>
                        <p><strong>Data Solicitação:</strong> <span id="modal-data-solicitacao"></span></p>
                        <p><strong>Outras Informações:</strong> <span id="modal-outras-inf"></span></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editCartaModal" tabindex="-1" aria-labelledby="editCartaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editCartaModalLabel">Editar Carta</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editCartaForm" class="edit-carta-form">
                            <input type="hidden" id="edit-carta-id" name="id">
                            <div class="mb-3">
                                <label for="edit-nome" class="form-label">Nome</label>
                                <input type="text" class="form-control" id="edit-nome" name="nome" required />
                            </div>
                            <div class="mb-3">
                                <label for="edit-email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="edit-email" name="email" required />
                            </div>
                            <div class="mb-3">
                                <label for="edit-destino" class="form-label">Destino</label>
                                <input type="text" class="form-control" id="edit-destino" name="destino" required />
                            </div>
                            <div class="mb-3">
                                <label for="edit-objetivo" class="form-label">Objetivo</label>
                                <input type="text" class="form-control" id="edit-objetivo" name="objectivo" required />
                            </div>
                            <div class="mb-3">
                                <label for="edit-tipo-carta" class="form-label">Tipo de Carta</label>
                                <select class="form-select" id="edit-tipo-carta" name="tipo_carta" required>
                                   {% for tipo in tipos_carta %}
                                    <option value="{{ tipo }}" {% if tipo == tipo_carta %}selected{% endif %}>{{ tipo }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="edit-telefone" class="form-label">Telefone</label>
                                <input type="text" class="form-control" id="edit-telefone" name="telefone" required />
                            </div>
                            <div class="mb-3">
                                <label for="edit-outras-inf" class="form-label">Outras Informações</label>
                                <textarea class="form-control" id="edit-outras-inf" name="outras_inf" required></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-brand" id="saveEditCarta">Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Função para obter o CSRF Token
        function getCsrfToken() {
            const cookie = document.cookie.split(';').find(c => c.trim().startsWith('csrftoken='));
            if (!cookie) {
                console.error('CSRF token not found in cookies.');
                showToast('errorToast', 'CSRF token não encontrado.');
                return null;
            }
            return decodeURIComponent(cookie.split('=')[1]);
        }
        const csrfToken = getCsrfToken();

        // Função para exibir toast
        function showToast(toastId, message) {
            console.log(`Exibindo toast: ${toastId} - ${message}`);
            const toastElement = document.getElementById(toastId);
            if (toastElement) {
                toastElement.querySelector('.toast-body').textContent = message;
                const toast = new bootstrap.Toast(toastElement, { delay: 5000 });
                toast.show();
            } else {
                console.error(`Elemento toast não encontrado: ${toastId}`);
            }
        }

        // Função para mostrar/esconder loading
        function showLoading(show = true) {
            console.log(show ? 'Mostrando overlay de carregamento' : 'Escondendo overlay de carregamento');
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Função para alternar o menu
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        if (menuToggle && sidebar) {
            menuToggle.addEventListener('click', () => {
                console.log('Alternando sidebar');
                sidebar.classList.toggle('open');
                sidebar.classList.toggle('closed');
            });
        } else {
            console.error('Elementos de menu ou sidebar não encontrados.');
        }

        // Função para animar contagem
        function animateCount(element, target, duration = 1000) {
            const start = parseFloat(element.dataset.value) || 0;
            const end = Math.round(target);
            const increment = (end - start) / (duration / 16);
            let current = start;
            const step = () => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                } else {
                    requestAnimationFrame(step);
                }
                element.textContent = Math.round(current);
                element.dataset.value = current;
            };
            requestAnimationFrame(step);
        }

        // Função para atualizar dashboard
        function updateDashboard(data) {
            console.log('Dados recebidos para o dashboard:', data);
            if (!data.cartas || !Array.isArray(data.cartas)) {
                console.error('Cartas não encontradas ou formato inválido:', data.cartas);
                showToast('errorToast', 'Erro: Dados de cartas inválidos.');
                return;
            }

            const viewType = document.querySelector('.view-toggle-btn.active').dataset.view;
            let totalPendentes = data.total_pendentes || 0;
            let totalFeitas = data.total_feitas || 0;
            let totalGeral = data.total_geral || 0;

            const tiposData = {};
            const datasData = {};

            data.cartas.forEach(carta => {
                const tipo = carta.tipo_carta || 'Desconhecido';
                if (!tiposData[tipo]) {
                    tiposData[tipo] = { count: 0 };
                }
                tiposData[tipo].count++;

                const dataSolicitacao = carta.data_solicitacao ? carta.data_solicitacao.split(' ')[0] : 'Sem Data';
                if (!datasData[dataSolicitacao]) {
                    datasData[dataSolicitacao] = { count: 0 };
                }
                datasData[dataSolicitacao].count++;
            });

            console.log('Total Pendentes:', totalPendentes);
            console.log('Total Feitas:', totalFeitas);
            console.log('Total Geral:', totalGeral);
            console.log('Tipos Data:', tiposData);
            console.log('Datas Data:', datasData);

            animateCount(document.getElementById('total-pendentes'), totalPendentes);
            animateCount(document.getElementById('total-feitas'), totalFeitas);
            animateCount(document.getElementById('total-geral'), totalGeral);

            const ctx = document.getElementById('cartaChart').getContext('2d');
            let labels, countsData;
            if (viewType === 'tipo') {
                labels = Object.keys(tiposData);
                countsData = labels.map(label => tiposData[label].count);
                document.querySelector('.chart-container h3').textContent = 'Cartas Pendentes por Tipo';
            } else {
                labels = Object.keys(datasData);
                countsData = labels.map(label => datasData[label].count);
                document.querySelector('.chart-container h3').textContent = 'Cartas Pendentes por Data de Solicitação';
            }

            if (window.cartaChartInstance) {
                window.cartaChartInstance.destroy();
            }
            window.cartaChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `Cartas por ${viewType === 'tipo' ? 'Tipo' : 'Data de Solicitação'}`,
                            data: countsData,
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#e2e8f0' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 14, family: 'Poppins' },
                                color: '#1e3a8a'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e3a8a',
                            titleFont: { family: 'Poppins' },
                            bodyFont: { family: 'Poppins' },
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y}`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Função para filtrar cartas
        function filterCartas(event) {
            if (event) event.preventDefault();
            const search = document.getElementById('searchInput').value || '';
            const referencia = document.getElementById('referenciaFilter').value || '';
            const tipo = document.getElementById('tipoFilter').value || '';
            const dataFiltro = document.getElementById('dataFilter').value || '';
            const chartLoader = document.getElementById('chart-loader');
            const tableSection = document.getElementById('table-section');
            const tableResponsive = document.querySelector('.table-responsive');
            const cardList = document.querySelector('.card-list');
            const noDataMessage = document.getElementById('no-data-message');
            chartLoader.style.display = 'block';
            showLoading(true);

            fetch(`{% url 'webiel:dashboard' %}?search=${encodeURIComponent(search)}&referencia=${encodeURIComponent(referencia)}&tipo=${encodeURIComponent(tipo)}&data=${encodeURIComponent(dataFiltro)}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(`Erro na resposta do servidor: ${text}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                chartLoader.style.display = 'none';
                showLoading(false);
                const tbody = document.querySelector('#cartasTable tbody');
                if (data.success && data.cartas && data.cartas.length > 0) {
                    if (tbody) {
                        tbody.innerHTML = '';
                        data.cartas.forEach(carta => {
                            const row = document.createElement('tr');
                            row.setAttribute('data-carta-id', carta.id);
                            row.innerHTML = `
                                <td>${carta.referencia || '-'}</td>
                                <td>${carta.nome || '-'}</td>
                                <td>${carta.email || '-'}</td>
                                <td>${carta.destino || '-'}</td>
                                <td>${carta.objectivo || '-'}</td>
                                <td>${carta.tipo_carta || '-'}</td>
                                <td>${carta.telefone || '-'}</td>
                                <td>${carta.data_solicitacao || '-'}</td>
                                <td>
                                    <div class="actions-container">
                                        <span class="status-icon text-warning mark-done" title="Marcar como concluída" data-id="${carta.id}">
                                            <i class="bi bi-hourglass-split"></i>
                                        </span>
                                        <span class="status-icon text-primary edit-icon" title="Editar" data-id="${carta.id}" data-bs-toggle="modal" data-bs-target="#editCartaModal">
                                            <i class="bi bi-pencil-square"></i>
                                        </span>
                                        <span class="status-icon text-danger delete-icon" title="Deletar" data-id="${carta.id}">
                                            <i class="bi bi-trash"></i>
                                        </span>
                                        <span class="status-icon text-info view-icon" title="Visualizar" data-id="${carta.id}" data-bs-toggle="modal" data-bs-target="#viewCartaModal">
                                            <i class="bi bi-eye"></i>
                                        </span>
                                    </div>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    if (cardList) {
                        cardList.innerHTML = '';
                        data.cartas.forEach(carta => {
                            const card = document.createElement('div');
                            card.className = 'card-carta';
                            card.setAttribute('data-carta-id', carta.id);
                            card.innerHTML = `
                                <div class="card-title">${carta.nome || '-'} (${carta.referencia || '-'})</div>
                                <div class="card-text"><strong>Referência:</strong> ${carta.referencia || '-'}</div>
                                <div class="card-text"><strong>Email:</strong> ${carta.email || '-'}</div>
                                <div class="card-text"><strong>Destino:</strong> ${carta.destino || '-'}</div>
                                <div class="card-text"><strong>Objetivo:</strong> ${carta.objectivo || '-'}</div>
                                <div class="card-text"><strong>Tipo:</strong> ${carta.tipo_carta || '-'}</div>
                                <div class="card-text"><strong>Telefone:</strong> ${carta.telefone || '-'}</div>
                                <div class="card-text"><strong>Data Solicitação:</strong> ${carta.data_solicitacao || '-'}</div>
                                <div class="card-text">
                                    <strong>Ações:</strong>
                                    <div class="actions-container">
                                        <span class="status-icon text-warning mark-done" title="Marcar como concluída" data-id="${carta.id}">
                                            <i class="bi bi-hourglass-split"></i>
                                        </span>
                                        <span class="status-icon text-primary edit-icon" title="Editar" data-id="${carta.id}" data-bs-toggle="modal" data-bs-target="#editCartaModal">
                                            <i class="bi bi-pencil-square"></i>
                                        </span>
                                        <span class="status-icon text-danger delete-icon" title="Deletar" data-id="${carta.id}">
                                            <i class="bi bi-trash"></i>
                                        </span>
                                        <span class="status-icon text-info view-icon" title="Visualizar" data-id="${carta.id}" data-bs-toggle="modal" data-bs-target="#viewCartaModal">
                                            <i class="bi bi-eye"></i>
                                        </span>
                                    </div>
                                </div>
                            `;
                            cardList.appendChild(card);
                        });
                    }
                    tableResponsive.style.display = 'block';
                    cardList.style.display = 'block';
                    noDataMessage.style.display = 'none';
                } else {
                    if (tbody) tbody.innerHTML = '';
                    if (cardList) cardList.innerHTML = '';
                    tableResponsive.style.display = 'none';
                    cardList.style.display = 'none';
                    noDataMessage.style.display = 'block';
                }
                updateDashboard(data);
            })
            .catch(error => {
                chartLoader.style.display = 'none';
                showLoading(false);
                console.error('Erro no filtro:', error);
                showToast('errorToast', `Erro ao filtrar cartas: ${error.message}`);
                if (tbody) tbody.innerHTML = '';
                if (cardList) cardList.innerHTML = '';
                tableResponsive.style.display = 'none';
                cardList.style.display = 'none';
                noDataMessage.style.display = 'block';
            });
        }

        // Ações de Marcar como Concluída
        document.addEventListener('click', function(e) {
            if (e.target.closest('.mark-done')) {
                const icon = e.target.closest('.mark-done');
                const cartaId = icon.getAttribute('data-id');
                const row = document.querySelector(`tr[data-carta-id="${cartaId}"]`);
                const card = document.querySelector(`.card-carta[data-carta-id="${cartaId}"]`);
                showLoading(true);
                fetch("{% url 'webiel:marcar_feita' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({ id: cartaId })
                })
                .then(response => response.json())
                .then(data => {
                    showLoading(false);
                    if (data.status === 'success') {
                        showToast('successToast', 'Carta marcada como concluída!');
                        if (row) row.remove();
                        if (card) card.remove();
                        const totalPendentes = parseInt(document.getElementById('total-pendentes').textContent);
                        const totalFeitas = parseInt(document.getElementById('total-feitas').textContent);
                        animateCount(document.getElementById('total-pendentes'), totalPendentes - 1);
                        animateCount(document.getElementById('total-feitas'), totalFeitas + 1);
                        if (!document.querySelector('#cartasTable tbody tr') && !document.querySelector('.card-carta')) {
                            document.querySelector('.table-responsive').style.display = 'none';
                            document.querySelector('.card-list').style.display = 'none';
                            document.getElementById('no-data-message').style.display = 'block';
                        }
                        filterCartas();
                    } else {
                        showToast('errorToast', 'Erro ao marcar a carta como concluída.');
                    }
                })
                .catch(error => {
                    showLoading(false);
                    showToast('errorToast', 'Erro ao marcar a carta como concluída.');
                });
            }
        });

        // Ações de Deletar
        document.addEventListener('click', function(e) {
            if (e.target.closest('.delete-icon')) {
                if (!confirm('Tem certeza que deseja deletar esta carta?')) return;
                const icon = e.target.closest('.delete-icon');
                const cartaId = icon.getAttribute('data-id');
                const row = document.querySelector(`tr[data-carta-id="${cartaId}"]`);
                const card = document.querySelector(`.card-carta[data-carta-id="${cartaId}"]`);
                showLoading(true);
                fetch(`/deletar-carta/${cartaId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({ id: cartaId })
                })
                .then(response => response.json())
                .then(data => {
                    showLoading(false);
                    if (data.status === 'success') {
                        showToast('successToast', 'Carta deletada com sucesso!');
                        if (row) row.remove();
                        if (card) card.remove();
                        const totalPendentes = parseInt(document.getElementById('total-pendentes').textContent);
                        const totalGeral = parseInt(document.getElementById('total-geral').textContent);
                        animateCount(document.getElementById('total-pendentes'), totalPendentes - 1);
                        animateCount(document.getElementById('total-geral'), totalGeral - 1);
                        if (!document.querySelector('#cartasTable tbody tr') && !document.querySelector('.card-carta')) {
                            document.querySelector('.table-responsive').style.display = 'none';
                            document.querySelector('.card-list').style.display = 'none';
                            document.getElementById('no-data-message').style.display = 'block';
                        }
                        filterCartas();
                    } else {
                        showToast('errorToast', 'Erro ao deletar a carta.');
                    }
                })
                .catch(error => {
                    showLoading(false);
                    showToast('errorToast', 'Erro ao deletar a carta.');
                });
            }
        });

        // Ações de Visualizar
        document.addEventListener('click', function(e) {
            if (e.target.closest('.view-icon')) {
                const icon = e.target.closest('.view-icon');
                const cartaId = icon.getAttribute('data-id');
                showLoading(true);
                fetch(`/visualizar-carta/${cartaId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    showLoading(false);
                    if (data.status === 'success') {
                        document.getElementById('modal-referencia').textContent = data.carta.referencia || '-';
                        document.getElementById('modal-nome').textContent = data.carta.nome || '-';
                        document.getElementById('modal-email').textContent = data.carta.email || '-';
                        document.getElementById('modal-destino').textContent = data.carta.destino || '-';
                        document.getElementById('modal-objetivo').textContent = data.carta.objectivo || '-';
                        document.getElementById('modal-tipo').textContent = data.carta.tipo_carta || '-';
                        document.getElementById('modal-telefone').textContent = data.carta.telefone || '-';
                        document.getElementById('modal-data-solicitacao').textContent = data.carta.data_solicitacao || '-';
                        document.getElementById('modal-outras-inf').textContent = data.carta.outras_inf || '-';
                    } else {
                        showToast('errorToast', 'Erro ao carregar os detalhes da carta.');
                    }
                })
                .catch(error => {
                    showLoading(false);
                    showToast('errorToast', 'Erro ao carregar os detalhes da carta.');
                });
            }
        });

        // Ações de Editar
        document.addEventListener('click', function(e) {
            if (e.target.closest('.edit-icon')) {
                const icon = e.target.closest('.edit-icon');
                const cartaId = icon.getAttribute('data-id');
                showLoading(true);
                fetch(`/visualizar-carta/${cartaId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    showLoading(false);
                    if (data.status === 'success') {
                        document.getElementById('edit-carta-id').value = cartaId;
                        document.getElementById('edit-nome').value = data.carta.nome || '';
                        document.getElementById('edit-email').value = data.carta.email || '';
                        document.getElementById('edit-destino').value = data.carta.destino || '';
                        document.getElementById('edit-objetivo').value = data.carta.objectivo || '';
                        document.getElementById('edit-tipo-carta').value = data.carta.tipo_carta || '';
                        document.getElementById('edit-telefone').value = data.carta.telefone || '';
                        document.getElementById('edit-outras-inf').value = data.carta.outras_inf || '';
                    } else {
                        showToast('errorToast', 'Erro ao carregar os dados da carta para edição.');
                    }
                })
                .catch(error => {
                    showLoading(false);
                    showToast('errorToast', 'Erro ao carregar os dados da carta para edição.');
                });
            }
        });

        document.getElementById('saveEditCarta').addEventListener('click', function() {
            const form = document.getElementById('editCartaForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            const cartaId = data.id;
            showLoading(true);
            fetch(`/editar-carta/${cartaId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                if (data.status === 'success') {
                    showToast('successToast', 'Carta editada com sucesso!');
                    const row = document.querySelector(`tr[data-carta-id="${cartaId}"]`);
                    const card = document.querySelector(`.card-carta[data-carta-id="${cartaId}"]`);
                    if (row) {
                        row.cells[0].textContent = data.carta.referencia || '-';
                        row.cells[1].textContent = data.carta.nome || '-';
                        row.cells[2].textContent = data.carta.email || '-';
                        row.cells[3].textContent = data.carta.destino || '-';
                        row.cells[4].textContent = data.carta.objectivo || '-';
                        row.cells[5].textContent = data.carta.tipo_carta || '-';
                        row.cells[6].textContent = data.carta.telefone || '-';
                        row.cells[7].textContent = data.carta.data_solicitacao || '-';
                    }
                    if (card) {
                        card.querySelector('.card-title').textContent = `${data.carta.nome || '-'} (${data.carta.referencia || '-'})`;
                        card.querySelectorAll('.card-text')[0].innerHTML = `<strong>Referência:</strong> ${data.carta.referencia || '-'}`;
                        card.querySelectorAll('.card-text')[1].innerHTML = `<strong>Email:</strong> ${data.carta.email || '-'}`;
                        card.querySelectorAll('.card-text')[2].innerHTML = `<strong>Destino:</strong> ${data.carta.destino || '-'}`;
                        card.querySelectorAll('.card-text')[3].innerHTML = `<strong>Objetivo:</strong> ${data.carta.objectivo || '-'}`;
                        card.querySelectorAll('.card-text')[4].innerHTML = `<strong>Tipo:</strong> ${data.carta.tipo_carta || '-'}`;
                        card.querySelectorAll('.card-text')[5].innerHTML = `<strong>Telefone:</strong> ${data.carta.telefone || '-'}`;
                        card.querySelectorAll('.card-text')[6].innerHTML = `<strong>Data Solicitação:</strong> ${data.carta.data_solicitacao || '-'}`;
                    }
                    bootstrap.Modal.getInstance(document.getElementById('editCartaModal')).hide();
                    filterCartas();
                } else {
                    showToast('errorToast', 'Erro ao editar a carta.');
                }
            })
            .catch(error => {
                showLoading(false);
                showToast('errorToast', 'Erro ao editar a carta.');
            });
        });

        // Adicionar eventos aos filtros
        document.getElementById('filterForm').addEventListener('submit', filterCartas);
        document.getElementById('searchInput').addEventListener('input', filterCartas);
        document.getElementById('referenciaFilter').addEventListener('input', filterCartas);
        document.getElementById('tipoFilter').addEventListener('change', filterCartas);
        document.getElementById('dataFilter').addEventListener('change', filterCartas);
        document.getElementById('clearFilters').addEventListener('click', () => {
            console.log('Limpando filtros');
            document.getElementById('searchInput').value = '';
            document.getElementById('referenciaFilter').value = '';
            document.getElementById('tipoFilter').value = '';
            document.getElementById('dataFilter').value = '';
            filterCartas();
        });

        // Alternar visualização
        document.querySelectorAll('.view-toggle-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                console.log(`Alternando visualização para: ${btn.dataset.view}`);
                document.querySelectorAll('.view-toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterCartas();
            });
        });

        // Mostrar mensagem de toast e inicializar
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Página carregada');
            {% for message in messages %}
                {% if message.tags == 'success' %}
                    showToast('successToast', '{{ message }}');
                {% elif message.tags == 'error' %}
                    showToast('errorToast', '{{ message }}');
                {% endif %}
            {% endfor %}

            // Logout automático após 5 minutos de inatividade
            let inactivityTimeout;
            const inactivityTime = 5 * 60 * 1000;

            function resetInactivityTimer() {
                console.log('Resetando temporizador de inatividade');
                clearTimeout(inactivityTimeout);
                inactivityTimeout = setTimeout(() => {
                    console.log('Executando logout por inatividade');
                    window.location.href = "{% url 'webiel:logout' %}";
                }, inactivityTime);
            }

            ['click', 'mousemove', 'keydown', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer, true);
            });

            resetInactivityTimer();

            // Carregar iniciais
            filterCartas();
        });
    </script>
</body>
</html>