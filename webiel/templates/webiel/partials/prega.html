{% load static %}

<section class="live-section">
  <div class="live-container">
    <div class="live-text">
      <h1>Cultos On-line</h1>
      <p>
        Acompanhe os cultos que temos frequentemente preparados para si.
        Cada momento é uma oportunidade de edificação e crescimento espiritual.
      </p>
      <blockquote>
        "Porque onde estiverem dois ou três reunidos em meu nome,
        ali estou no meio deles." – Mateus 18:20
      </blockquote>
    </div>

    <div class="live-video" id="videoArea">
      <div id="player"></div>
      
      <div class="video-overlay" id="videoOverlay" style="pointer-events: none;">
        <span>Passa o cursor ou dedo para assistir</span>
      </div>
    </div>
  </div>
</section>

<script>
  // 1. Evitar conflitos: verificamos se a tag já existe
  if (!document.getElementById('yt-api-script')) {
    var tag = document.createElement('script');
    tag.id = 'yt-api-script';
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  }

  var player;
  var isPlayerReady = false;

  // Função global exigida pela API do YouTube
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '100%',
      width: '100%',
      videoId: 'DzABU0QQdMk',
      playerVars: {
        'autoplay': 0,
        'mute': 1,
        'enablejsapi': 1,
        'origin': window.location.origin,
        'rel': 0,
        'controls': 1
      },
      events: {
        'onReady': function(event) {
          isPlayerReady = true;
          console.log("✅ Conexão segura estabelecida.");
        }
      }
    });
  }

  document.addEventListener("DOMContentLoaded", function() {
    const videoArea = document.getElementById("videoArea");

    // Proteção para o AOS não quebrar a página
    try {
      if (typeof AOS !== 'undefined') {
        AOS.init();
      }
    } catch (e) {
      console.warn("AOS não definido, ignorando...");
    }

    if (videoArea) {
      videoArea.addEventListener("mouseenter", function() {
        if (isPlayerReady && player && typeof player.playVideo === 'function') {
          player.playVideo();
        }
      });

      videoArea.addEventListener("mouseleave", function() {
        if (isPlayerReady && player && typeof player.pauseVideo === 'function') {
          player.pauseVideo();
        }
      });
    }
  });
</script>